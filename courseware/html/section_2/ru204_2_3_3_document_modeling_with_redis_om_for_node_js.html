<style type= text/css>
  .code {font-family: 'courier new', courier; font-weight: bold; font-size: 18px !important;}
</style>
<p>We've provided you with a small example program that uses the Node.js Redis OM client to store and manipulate a new book object in Redis.</p>
<p>The code is located in the <span class="code"><a href="https://github.com/redislabs-training/ru204/tree/main/src/nodejs/redis_om_example" target="_blank" class="page-link">src/nodejs/redis_om_example</a></span> folder in the course GitHub repository.  You should have already cloned this repository to your machine as part of the initial course setup step.</p>
<p>Follow the instructions in the <a href="https://github.com/redislabs-training/ru204/blob/main/src/nodejs/redis_om_example/README.md" target="_blank" class="page-link">README.md</a> file if you'd like to run the code in your local environment.</p>
<h2>Code Walkthrough</h2>
<hr>
<p>The code is contained in a single file, <span class="code">json_om_example.js</span>.  <a href="https://github.com/redislabs-training/ru204/blob/main/src/nodejs/redis_om_example/json_om_example.js" target="_blank" class="page-link">Click here to open this file in GitHub</a> - you will need to refer to it throughout this module.</p>
<h2>Data Model</h2>
<hr>
<p>Let's begin by looking at the way that Redis OM Node.js models our book document.  We have a schema <span class="code">bookSchema</span> that defines what our entities look like and what the data type of each property is.</p>
<p>Note that at this time, Redis OM for Node.js does not support nested objects in JSON documents, so we're using a slightly "flattened' version of the model used with the other clients.  We'll update this course when this capability has been added to Redis OM Node.js.</p>
<p>Here's our entity and schema definition:</p>
<p><pre class="code">
class Book extends Entity {};

const bookSchema = new Schema(Book, {
author: { type: 'string' },
id: { type: 'string' }, 
description: { type: 'string' },
genres:  { type: 'string[]' },
pages: { type: 'number' },
title: { type: 'string' },
url: { type: 'string' },
yearPublished:  { type: 'number' },
// Redis OM Node does not yet support embedded objects, 
// so the metrics object has been flattened to the following
// two fields, and we have omitted the inventory array of 
// objects for the same reason.
ratingVotes: { type: 'number' },
score: { type: 'number' }
}, {
prefix: 'ru204:redis-om-node:book'
});    
</pre></p>
<p>The <span class="code">prefix</span> is used to specify metadata about our book entities. Here we're saying that we want Redis OM to store books in Redis using keys beginning with <span class="code">ru204:redis-om-node:book</span>.  The full key name for a given book will be <span class="code">ru204:redis-om-node:book:%lt;;ulid%gt;</span>, using the ULID generated by Redis OM when we create a <span class="code">Book</span> instance.</p>
<h2>Storing Entities in Redis</h2>
<hr>
<p>To create and persist entities with Redis OM Node.js, we need to obtain a Repository:</p>
<p><pre class="code">
const bookRepository = client.fetchRepository(bookSchema);
</pre></p>
<p>Now we can create an entity:</p>
<p><pre class="code">
const newBook = bookRepository.createEntity({
author: 'Redis Staff',
id: '999',
description: 'This is a book all about Redis.',
genres: [ 'redis', 'tech', 'computers' ],
pages: 1000,
title: 'Redis for Beginners',
url: 'https://university.redis.com/courses/ru204/',
yearPublished: 2022,
ratingVotes: 4000,
score: 4.5
});      
</pre></p>
<p>Redis OM generates a ULID ID for this entity that we can access as the <span class="code">entityId</span> property:</p>
<p><pre class="code">
newBook.entityId
</pre></p>
<p>Without knowing what the Redis command(s) involved are, we can store our new book in Redis like this:</p>
<p><pre class="code">
await bookRepository.save(newBook);
</pre></p>
<h2>Retrieving Entities from Redis</h2>
<hr>
<p>Let's retrieve that book using its ULID (note we don't need to know the entire Redis key to retrieve the book):</p>
<p><pre class="code">
const aBook = await bookRepository.fetch(newBook.entityId);
</pre></p>
<h2>Updating Entities in Redis</h2>
<hr>
<p>To update a property, change its value and save the book back to Redis:</p>
<p><pre class="code">
aBook.author = 'Redis University';
await bookRepository.save(aBook);  
</pre></p>
<h2>Further Details</h2>
<p>For more about the Redis OM Node.js client, <a href="https://github.com/redis/redis-om-node" target="_blank" class="page-link">explore the documentation on GitHub</a>.  We'll cover indexing and searching capabilities later in this course.</p>