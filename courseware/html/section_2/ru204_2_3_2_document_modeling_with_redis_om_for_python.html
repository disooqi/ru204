<style type= text/css>
  .code {font-family: 'courier new', courier; font-weight: bold; font-size: 18px !important;}
</style>
<p>We've provided you with a small example program that uses the Python Redis OM client to store and manipulate a new book object in Redis.</p>
<p>The code is located in the <span class="code"><a href="https://github.com/redislabs-training/ru204/tree/main/src/python/redis_om_example" target="_blank" class="page-link">src/python/redis_om_example</a></span> folder in the course GitHub repository.  You should have already cloned this repository to your machine as part of the initial course setup step.</p>
<p>Follow the instructions in the <a href="https://github.com/redislabs-training/ru204/blob/main/src/python/redis_om_example/README.md" target="_blank" class="page-link">README.md</a> file if you'd like to run the code in your local environment.</p>
<h2>Code Walkthrough</h2>
<hr>
<p>The code is contained in a single file, <span class="code">json_om_example.py</span>.  <a href="https://github.com/redislabs-training/ru204/blob/main/src/python/redis_om_example/json_om_example.py" target="_blank" class="page-link">Click here to open this file in GitHub</a> - you will need to refer to it throughout this module.</p>
<h2>Data Model</h2>
<p>Let's begin by looking at the way that Redis OM Python models our book document.  We have a class <span class="code">Book</span> that extends the Redis OM class <span class="code">JsonModel</span> - this tells Redis OM that we want to persist our entities to Redis as JSON documents.</p>
<p>The class definition names all of our properties and specifies their types.  We can use <a href="https://pydantic-docs.helpmanual.io/" target="_blank" class="page-link">Pydantic</a> to define field types, for example <span class="code">year_published</span> is a <span class="code">PositiveInt</span> and <span class="code">url</span> is of type <span class="code">AnyHttpURL</span>.  Here's our <span class="code">Book</span> class:
<p><pre class="code">
class Book(JsonModel):
    author: str
    id: str
    description: str
    genres: List[str]
    inventory: List[InventoryItem]
    metrics: Metrics
    pages: PositiveInt
    title: str
    url: AnyHttpUrl
    year_published: PositiveInt

    # Extra configuration to specify how to generate key
    # names when saving an instance of the model in Redis.
    class Meta:
        global_key_prefix="ru204:redis-om-python"
        model_key_prefix="book"
</pre></p>
<p>The <span class="code">Meta</span> class is used to specify metadata about our book entities. Here we're saying that we want Redis OM to store books in Redis using keys beginning with <span class="code">ru204:redis-om-python:book</span>.  The full key name for a given book will be <span class="code">ru204:redis-om-python:book:&lt;ulid&gt;</span>, using the ULID generated by Redis OM when we create an instance of the <span class="code">Book</span> class.</p>
<p>In Redis OM Python, we model nested objects by extending the <span class="code">EmbeddedJsonModel</span> class:</p>
<p><pre class="code">
class Metrics(EmbeddedJsonModel):
    rating_votes: PositiveInt
    score: PositiveFloat

class InventoryItem(EmbeddedJsonModel):
    status: str
    stock_id: str
</pre></p>
<p>Note that in the <span class="code">Book</span> class, the field <span class="code">inventory</span> is defined as a <span class="code">List[InventoryItem]</span>.  When persisted to Redis as a JSON document, this will become an array of <span class="code">InventoryItem</span> objects.</p>
<h2>Storing Entities in Redis</h2>
<hr>
<p>Let's take a look at the code that stores and updates JSON documents.  To store a new book, we first need to create an instance of the <span class="code">Book</span> object:</p>
<p><pre class="code">
new_book = Book(
    author = "Redis Staff",
    id = "999",
    description = "This is a book all about Redis.",
    genres = [ "redis", "tech", "computers" ],
    inventory = [ 
        InventoryItem(
            status = "on_loan",
            stock_id = "999_1"
        ),
        InventoryItem(
            status = "maintenance",
            stock_id = "999_2"
        )
    ],
    metrics = Metrics(
        rating_votes = 4000,
        score = 4.5
    ),
    pages = 1000,
    title = "Redis for Beginners",
    url = "https://university.redis.com/courses/ru204/",
    year_published = 2022
)    
</pre></p>
<p>Redis OM generates a ULID ID for this <span class="code">Book</span> instance, that we can access as the <span class="code">pk</span> property:</p>
<p><pre class="code">
print(f"new_book ULID: {new_book.pk}") 
</pre></p>
<p>Without knowing what the Redis command(s) involved are, we can store our new book in Redis like this:</p>
<p><pre class="code">
new_book.save()
</pre></p>
<h2>Retrieving Entities from Redis</h2>
<hr>
<p>Let's retrieve that book using its ULID (note we don't need to know the entire Redis key to retrieve the book):</p>
<p><pre class="code">
a_book = Book.get(new_book.pk)
</pre></p>
<h2>Updating Entities in Redis</h2>
<p>To update a property, change its value and save the book back to Redis:</p>
<p><pre class="code">
a_book.author = "Redis University"
a_book.save()    
</pre></p>
<h2>Further Details</h2>
<hr>
<p>For more about the Redis OM Python client, <a href="https://github.com/redis/redis-om-python" target="_blank" class="page-link">explore the documentation on GitHub</a>.  We'll cover indexing and searching capabilities later in this course.</p>
